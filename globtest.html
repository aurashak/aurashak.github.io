<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://aurashak.github.io/styles.css">
  <title>World Sphere</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
  </style>
</head>
<body>

  <!-- Include common header -->
  <div id="header-placeholder"></div>

  <!-- Include common navigation -->
  <div id="navigation-placeholder"></div>

  <!-- Include TopoJSON library -->
  <script src="https://unpkg.com/topojson@3"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <main>
    <script>
      // Set up Three.js
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Set the clear color of the renderer to white
      renderer.setClearColor(0xffffff);

      // Create a group to hold both the sphere and country outlines
      const group = new THREE.Group();
      scene.add(group);

      // Create a solid sphere
      const geometry = new THREE.SphereGeometry(5, 32, 32);
      const material = new THREE.MeshBasicMaterial({ color: 0x000000 });
      const sphere = new THREE.Mesh(geometry, material);
      group.add(sphere);

      // Set camera position
      camera.position.z = 15;

      // Load country border data
      fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Failed to fetch country data (HTTP ${response.status})`);
          }
          return response.json();
        })
        .then(world => {
          const countries = world.features;

          // Draw country outlines
          const outlineMaterial = new THREE.LineBasicMaterial({ color: 0xff0000 });
          countries.forEach(country => {
            const geometry = new THREE.BufferGeometry().setFromPoints(
              country.geometry.coordinates[0].map(coords => {
                const lon = coords[0];
                const lat = coords[1];
                return convertToSphereCoords(lat, lon, 5); // Convert to sphere coordinates
              })
            );

            const line = new THREE.Line(geometry, outlineMaterial);
            group.add(line);
          });
        })
        .catch(error => console.error('Error loading country data:', error.message));


      // Set up animation
      const animate = function () {
        requestAnimationFrame(animate);

        // Rotate the group during animation
        group.rotation.y += 0.005;

        renderer.render(scene, camera);
      };

      animate();

      // Add event listeners for window resize
      window.addEventListener('resize', () => {
        const newAspect = window.innerWidth / window.innerHeight;
        camera.aspect = newAspect;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      function toRadians(degrees) {
        return degrees * (Math.PI / 180);
      }

      // Helper function to convert latitude and longitude to sphere coordinates
      function convertToSphereCoords(lat, lon, radius) {
        const phi = toRadians(90 - lat);
        const theta = toRadians(lon + 180);
        const x = radius * Math.sin(phi) * Math.cos(theta);
        const y = radius * Math.cos(phi);
        const z = radius * Math.sin(phi) * Math.sin(theta);
        return new THREE.Vector3(x, y, z);
      }
    </script>
  </main>

  <!-- Include common footer -->
  <div id="footer-placeholder"></div>

  <script src="https://aurashak.github.io/common.js"></script>

</body>
</html>
